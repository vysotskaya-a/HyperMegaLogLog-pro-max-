# Отчет по исследованию алгоритма HyperLogLog

исследование вероятностного алгоритма HyperLogLog (HLL) для оценки мощности потока данных. Работа разделена на этапы: создание инфраструктуры, анализ стандартного алгоритма и анализ улучшенной версии.

## параметры
* **Регистры ($m$):** $2^{14} = 16384$ (параметр $b=14$).
* **Размер потока:** 200,000 элементов.
* **Количество прогонов:** 10 независимых запусков для усреднения статистики.

---

## Этап 2 и 3: Анализ Стандартного HyperLogLog

### Реализация
* Хеш-функция: 32-битная MurmurHash3.
* Хранилище: `std::vector<int>`.

### 1. Точность
Теоретическая ошибка для $b=14$ составляет $\approx \frac{1.04}{\sqrt{16384}} = 0.81\%$.
По результатам экспериментов (см. графики `plot_comparison_Standard.png`), средняя оценка алгоритма следует за истинным значением с высокой точностью, отклонения находятся в пределах 1%, что соответствует теории.

### 2. Стабильность
Область неопределенности (см. `plot_stats_Standard.png`) показывает, что стандартное отклонение ведет себя предсказуемо и уменьшается в относительном выражении по мере накопления данных.

### 3. Эффективность памяти
Стандартная реализация использует `int` (4 байта) для хранения ранга.
* Общий объем памяти: $16384 \times 4 = 65,536$ байт (~64 КБ).
* Это неэффективно, так как ранг редко превышает значение 32.

---

## Этап 4: Улучшенный HyperLogLog

Для устранения недостатков стандартной версии были внесены следующие изменения:

### Модификации (Этап 4.1)
1.  **Замена типа данных:** Переход с `std::vector<int>` на `std::vector<uint8_t>`. Поскольку максимальное количество нулей в хеше ограничено 64, одного байта (8 бит, макс. значение 255) достаточно.
2.  **64-битное хеширование:** Переход на `MurmurHash3_x64_128`. Это снижает вероятность коллизий хеша на больших объемах данных.

### анализ улучшенного алгоритма

Был проведен аналогичный эксперимент с 10 прогонами на потоке 200,000 элементов.

#### 1. Оценка точности (Улучшенный)
Анализ графика `plot_comparison_Improved.png` показывает, что точность улучшенного алгоритма идентична стандартному. Средняя ошибка по-прежнему составляет $\approx 0.8\%$. Это подтверждает корректность использования 8-битных регистров — переполнения не происходит.

#### 2. Анализ стабильности (Улучшенный)
Дисперсия результатов (график `plot_stats_Improved.png`) совпадает со стандартной версией. Изменение типа данных не влияет на стохастическую природу алгоритма.

#### 3. Сравнительный анализ памяти
Это главное достижение оптимизации.

| Версия | Тип регистра | Размер регистра | Общая память (Payload) |
| :--- | :--- | :--- | :--- |
| **Standard** | `int` | 32 бита | **64 КБ** |
| **Improved** | `uint8_t` | 8 бит | **16 КБ** |

**Вывод:**
Улучшенная версия потребляет в 4 раза меньше памяти (экономия 75%) при сохранении той же точности и дисперсии. Это позволяет либо существенно экономить ресурсы, либо увеличить параметр $b$ до 16 (используя те же 64 КБ), что повысит точность оценки в 2 раза.